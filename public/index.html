<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inua CRM - Login</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Moderustic:wght@300..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Text:ital@0;1&family=Moderustic:wght@300..800&display=swap" rel="stylesheet">
    <script>
        // Custom error classes
        class LoginError extends Error {
            constructor(message) {
                super(message);
                this.name = 'LoginError';
            }
        }

        class SignupError extends Error {
            constructor(message) {
                super(message);
                this.name = 'SignupError';
            }
        }

        class ForgotPasswordError extends Error {
            constructor(message) {
                super(message);
                this.name = 'ForgotPasswordError';
            }
        }

        // Function to handle form submissions
        function handleSubmit(formId, endpoint) {
            const form = document.getElementById(formId);
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        body: formData
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        switch(formId) {
                            case 'login-form':
                                throw new LoginError(errorData.message);
                            case 'signup-form':
                                throw new SignupError(errorData.message);
                            case 'forgot-password-form':
                                throw new ForgotPasswordError(errorData.message);
                        }
                    }
                    // Handle successful response
                    console.log('Success:', await response.json());
                } catch (error) {
                    // This will be caught by our errorHandler middleware
                    console.error('Error:', error);
                    alert(error.message);
                }
            });
        }

        // Initialize form handlers when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            handleSubmit('login-form', '/api/login');
            handleSubmit('signup-form', '/api/signup');
            handleSubmit('forgot-password-form', '/api/forgot-password');
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="left-side">
            <div class="logo">
                <img id="logo" src="./img/logo_v2-removebg-preview.png" alt="Inua Solutions Logo">
            </div>
            <h1>Inua Solutions</h1>
            <p>Empowering rural communities through access to essential goods on credit.</p>
            <div class="info-box orange-border">
                <h2>Flexible Credit Options</h2>
                <p>Our platform offers rural households the ability to acquire quality products with flexible repayment plans tailored to their needs.</p>
            </div>
            <div class="info-box blue-border">
                <h2>Transforming Rural Economies</h2>
                <p>By bridging the gap between rural families and essential goods, we foster economic growth and improve living standards across communities.</p>
            </div>
        </div>
        <div class="right-side">
            <h3>Sign In</h3>
            <form id="login-form">
                <div class="form-group">
                    <input type="email" id="login-email" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="login-password" placeholder="Password" required>
                </div>
                <a href="#" id="forgot-password" class="forgot-password">Forgot Password?</a>
                <button type="submit" class="login-button">Log In</button>
            </form>
            <div class="or-divider">
                <hr>
                <span>OR</span>
                <hr>
            </div>
            <p class="signup-text">Don't have an account? <a href="#" id="show-signup">Sign up</a></p>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="signup-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Sign Up</h3>
            <form id="signup-form">
                <div class="form-group">
                    <input type="text" id="signup-name" placeholder="Full Name" required>
                </div>
                <div class="form-group">
                    <input type="email" id="signup-email" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="signup-password" placeholder="Password" required>
                </div>
                <div class="form-group">
                    <select id="signup-role" required>
                        <option value="">Select Role</option>
                        <option value="customer_service">Customer Service</option>
                        <option value="sales_manager">Sales Manager</option>
                        <option value="group_leader">Group Leader</option>
                        <option value="other_manager">Other Manager</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button type="submit" class="signup-button">Sign Up</button>
            </form>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Reset Password</h3>
            <form id="forgot-password-form">
                <div class="form-group">
                    <input type="email" id="forgot-password-email" placeholder="Email" required>
                </div>
                <button type="submit" class="reset-button">Send Reset Link</button>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Inua Solutions. All rights reserved.</p>
        <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
    </footer>

    <script src="./js/auth.js"></script>
</body>
</html>